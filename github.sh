# Make executable with chmod +x <<filename.sh>>
echo "What is your github username?"
read USERNAME

if gh auth status;  then 
  echo 'already logged into github'
else 
  gh auth login
fi

if [ -d "./bitcointranscripts/" ]; then

  cd bitcointranscripts

else
  gh repo fork bitcointranscripts/bitcointranscripts --clone 

  cd bitcointranscripts

  git checkout -b "${3}"
fi

if [ ! -d "./${2}" ]; then 

  mkdir -p "${2}"
  
fi

IFS=/ read -a dirs <<< ${2}
IFS=' ' read -a sub_dirs <<< ${dirs[0]}

cd ${sub_dirs[0]}
if [ ! -f ./_index.md ]; then
  echo -e "---\ntitle: ${sub_dirs[0]}\n---\n\n{{< childpages >}}" >> _index.md
fi

cd ${sub_dirs[1]}

if [ ! -f ./_index.md ]; then
  echo -e "---\ntitle: ${dirs[0]}\n---\n\n{{< childpages >}}" >> _index.md
fi
 
cd ../..

mv "${1}" "./${2}"

git add . && git commit -m 'initial transcription using yt2btc tool'

gh repo set-default "${USERNAME}"/bitcointranscripts

BRANCH="$(git rev-parse --abbrev-ref HEAD)"

if [[ "$BRANCH" == "master" ]]; then

  git checkout -b "${3}"

fi

gh pr create --base master --title "Autogenerated yt2btc" --body "youtube to bitcoin transcript"

echo "Done"

